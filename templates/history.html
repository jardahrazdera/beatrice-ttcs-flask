{% extends "base.html" %}

{% block title %}Historie - Řízení ohřevu vody{% endblock %}

{% block content %}
<div class="history">
    <h2>Historie a statistiky</h2>

    <!-- Tab Navigation -->
    <div class="tabs">
        <button class="tab-btn active" data-tab="temperature">Teploty</button>
        <button class="tab-btn" data-tab="events">Události</button>
        <button class="tab-btn" data-tab="control">Řízení</button>
        <button class="tab-btn" data-tab="statistics">Statistiky</button>
    </div>

    <!-- Temperature History Tab -->
    <div id="temperature-tab" class="tab-content active">
        <div class="card">
            <h3>Historie teplot</h3>

            <!-- Date Range Selector -->
            <div class="form-group-inline">
                <label for="temp-range-type">Typ období:</label>
                <select id="temp-range-type" class="form-control">
                    <option value="relative" selected>Relativní</option>
                    <option value="absolute">Vlastní rozsah</option>
                </select>

                <div id="temp-relative-range" style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <label for="temp-hours">Časové období:</label>
                    <select id="temp-hours" class="form-control">
                        <option value="1">Poslední hodina</option>
                        <option value="6">Posledních 6 hodin</option>
                        <option value="12">Posledních 12 hodin</option>
                        <option value="24" selected>Posledních 24 hodin</option>
                        <option value="48">Poslední 2 dny</option>
                        <option value="168">Poslední týden</option>
                        <option value="720">Poslední měsíc</option>
                    </select>
                </div>

                <div id="temp-absolute-range" style="display: none; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <label for="temp-date-from">Od:</label>
                    <input type="datetime-local" id="temp-date-from" class="form-control">

                    <label for="temp-date-to">Do:</label>
                    <input type="datetime-local" id="temp-date-to" class="form-control">
                </div>

                <label for="temp-interval">Interval:</label>
                <select id="temp-interval" class="form-control">
                    <option value="1" selected>1 minuta</option>
                    <option value="5">5 minut</option>
                    <option value="15">15 minut</option>
                    <option value="60">1 hodina</option>
                    <option value="360">6 hodin</option>
                    <option value="1440">1 den</option>
                </select>

                <button id="refresh-temp" class="btn btn-primary">Obnovit</button>
                <button id="export-temp" class="btn btn-secondary">Exportovat CSV</button>
            </div>

            <!-- Temperature Chart -->
            <div class="chart-container">
                <canvas id="historyChart"></canvas>
            </div>

            <!-- Temperature Table -->
            <div class="table-container">
                <table id="temp-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Čas</th>
                            <th>Nádrž 1 (°C)</th>
                            <th>Nádrž 2 (°C)</th>
                            <th>Nádrž 3 (°C)</th>
                            <th>Průměr (°C)</th>
                        </tr>
                    </thead>
                    <tbody id="temp-table-body">
                        <tr>
                            <td colspan="5" class="loading">Načítám data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination Controls -->
            <div id="temp-pagination" class="pagination"></div>
        </div>
    </div>

    <!-- System Events Tab -->
    <div id="events-tab" class="tab-content">
        <div class="card">
            <h3>Systémové události</h3>

            <!-- Event Filters -->
            <div class="form-group-inline">
                <label for="events-range-type">Typ období:</label>
                <select id="events-range-type" class="form-control">
                    <option value="relative" selected>Relativní</option>
                    <option value="absolute">Vlastní rozsah</option>
                </select>

                <div id="events-relative-range" style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <label for="events-hours">Časové období:</label>
                    <select id="events-hours" class="form-control">
                        <option value="6">Posledních 6 hodin</option>
                        <option value="24" selected>Posledních 24 hodin</option>
                        <option value="48">Poslední 2 dny</option>
                        <option value="168">Poslední týden</option>
                        <option value="720">Poslední měsíc</option>
                    </select>
                </div>

                <div id="events-absolute-range" style="display: none; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <label for="events-date-from">Od:</label>
                    <input type="datetime-local" id="events-date-from" class="form-control">

                    <label for="events-date-to">Do:</label>
                    <input type="datetime-local" id="events-date-to" class="form-control">
                </div>

                <label for="event-type">Typ:</label>
                <select id="event-type" class="form-control">
                    <option value="">Všechny</option>
                    <option value="startup">Spuštění</option>
                    <option value="shutdown">Vypnutí</option>
                    <option value="error">Chyby</option>
                    <option value="warning">Varování</option>
                </select>

                <button id="refresh-events" class="btn btn-primary">Obnovit</button>
            </div>

            <!-- Events Table -->
            <div class="table-container">
                <table id="events-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Čas</th>
                            <th>Typ</th>
                            <th>Popis</th>
                        </tr>
                    </thead>
                    <tbody id="events-table-body">
                        <tr>
                            <td colspan="3" class="loading">Načítám události...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination Controls -->
            <div id="events-pagination" class="pagination"></div>
        </div>
    </div>

    <!-- Control Actions Tab -->
    <div id="control-tab" class="tab-content">
        <div class="card">
            <h3>Historie řízení</h3>

            <!-- Control Filters -->
            <div class="form-group-inline">
                <label for="control-range-type">Typ období:</label>
                <select id="control-range-type" class="form-control">
                    <option value="relative" selected>Relativní</option>
                    <option value="absolute">Vlastní rozsah</option>
                </select>

                <div id="control-relative-range" style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <label for="control-hours">Časové období:</label>
                    <select id="control-hours" class="form-control">
                        <option value="6">Posledních 6 hodin</option>
                        <option value="12">Posledních 12 hodin</option>
                        <option value="24" selected>Posledních 24 hodin</option>
                        <option value="48">Poslední 2 dny</option>
                        <option value="168">Poslední týden</option>
                        <option value="720">Poslední měsíc</option>
                    </select>
                </div>

                <div id="control-absolute-range" style="display: none; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <label for="control-date-from">Od:</label>
                    <input type="datetime-local" id="control-date-from" class="form-control">

                    <label for="control-date-to">Do:</label>
                    <input type="datetime-local" id="control-date-to" class="form-control">
                </div>

                <button id="refresh-control" class="btn btn-primary">Obnovit</button>
            </div>

            <!-- Control Actions Table -->
            <div class="table-container">
                <table id="control-table" class="data-table">
                    <thead>
                        <tr>
                            <th>Čas</th>
                            <th>Akce</th>
                            <th>Topení</th>
                            <th>Čerpadlo</th>
                            <th>Teplota (°C)</th>
                            <th>Cílová teplota (°C)</th>
                        </tr>
                    </thead>
                    <tbody id="control-table-body">
                        <tr>
                            <td colspan="6" class="loading">Načítám historii řízení...</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination Controls -->
            <div id="control-pagination" class="pagination"></div>
        </div>
    </div>

    <!-- Statistics Tab -->
    <div id="statistics-tab" class="tab-content">
        <div class="card">
            <h3>Statistiky</h3>

            <!-- Statistics Period Selector -->
            <div class="form-group-inline">
                <label for="stats-hours">Časové období:</label>
                <select id="stats-hours" class="form-control">
                    <option value="24" selected>Posledních 24 hodin</option>
                    <option value="168">Poslední týden</option>
                    <option value="720">Poslední měsíc</option>
                    <option value="4320">Posledních 6 měsíců</option>
                    <option value="8760">Poslední rok</option>
                </select>

                <button id="refresh-stats" class="btn btn-primary">Obnovit</button>
            </div>

            <!-- Statistics Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h4>Průměrná teplota</h4>
                    <div class="stat-value" id="stat-avg-temp">--</div>
                    <div class="stat-unit">°C</div>
                </div>

                <div class="stat-card">
                    <h4>Minimální teplota</h4>
                    <div class="stat-value" id="stat-min-temp">--</div>
                    <div class="stat-unit">°C</div>
                </div>

                <div class="stat-card">
                    <h4>Maximální teplota</h4>
                    <div class="stat-value" id="stat-max-temp">--</div>
                    <div class="stat-unit">°C</div>
                </div>

                <div class="stat-card">
                    <h4>Topení zapnuto</h4>
                    <div class="stat-value" id="stat-heating-time">--</div>
                    <div class="stat-unit">hodin</div>
                </div>

                <div class="stat-card">
                    <h4>Čerpadlo zapnuto</h4>
                    <div class="stat-value" id="stat-pump-time">--</div>
                    <div class="stat-unit">hodin</div>
                </div>

                <div class="stat-card">
                    <h4>Počet cyklů topení</h4>
                    <div class="stat-value" id="stat-heating-cycles">--</div>
                    <div class="stat-unit">cyklů</div>
                </div>

                <div class="stat-card">
                    <h4>Počet měření</h4>
                    <div class="stat-value" id="stat-reading-count">--</div>
                    <div class="stat-unit">záznamů</div>
                </div>

                <div class="stat-card">
                    <h4>Využití topení</h4>
                    <div class="stat-value" id="stat-heating-percent">--</div>
                    <div class="stat-unit">%</div>
                </div>
            </div>

            <!-- Detailed Statistics Table -->
            <div class="card">
                <h4>Detailní statistiky podle nádrží</h4>
                <div class="table-container">
                    <table id="stats-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Nádrž</th>
                                <th>Průměr (°C)</th>
                                <th>Min (°C)</th>
                                <th>Max (°C)</th>
                                <th>Počet měření</th>
                            </tr>
                        </thead>
                        <tbody id="stats-table-body">
                            <tr>
                                <td colspan="5" class="loading">Načítám statistiky...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Back Button -->
    <div class="history-footer">
        <a href="{{ url_for('index') }}" class="btn btn-secondary">Zpět na dashboard</a>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/vendor/chart.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/history.js') }}"></script>
{% endblock %}
