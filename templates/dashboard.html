{% extends "base.html" %}

{% block title %}Dashboard - Řízení ohřevu vody{% endblock %}

{% block extra_css %}
<script src="{{ url_for('static', filename='js/vendor/chart.min.js') }}"></script>
{% endblock %}

{% block content %}
<div class="dashboard">
    <div style="margin-bottom: 1.5rem;">
        <h2 style="margin: 0 0 1rem 0; text-align: center;">Přehled systému</h2>
        <div style="display: flex; align-items: center; justify-content: center; gap: 2rem; flex-wrap: wrap;">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span id="connection-pulse" class="connection-pulse"></span>
                <span id="connection-status" style="font-size: 0.875rem; color: var(--text-secondary);">Připojování...</span>
            </div>
            <div id="last-update" style="font-size: 0.875rem; color: var(--text-secondary);">
                Poslední aktualizace: --
            </div>
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <div id="current-date" style="font-size: 0.875rem; color: var(--text-secondary);"></div>
                <div id="current-time" style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary);"></div>
            </div>
        </div>
    </div>

    <!-- Stale Data Warning Banner -->
    <div id="stale-data-warning" class="alert alert-warning" style="display: none;">
        <strong>⚠️ Varování: Neaktuální data</strong>
        <p>Poslední aktualizace dat proběhla před více než 30 sekundami. Zkontrolujte připojení k serveru.</p>
    </div>

    <!-- Heating System Disabled Warning Banner -->
    <div id="heating-system-disabled-warning" class="alert alert-danger" style="display: none;">
        <strong>⚠️ VAROVÁNÍ: SYSTÉM TOPENÍ VYPNUT!</strong>
        <p>Automatické řízení topení je deaktivováno. Topení se nezapne, dokud systém znovu nezapnete v nastavení.</p>
        <p><a href="{{ url_for('settings') }}" class="btn btn-warning">Přejít do nastavení</a></p>
    </div>

    <!-- Manual Override Warning Banner -->
    <div id="manual-override-warning" class="alert alert-danger" style="display: none;">
        <strong>⚠️ VAROVÁNÍ: MANUÁLNÍ REŽIM AKTIVNÍ!</strong>
        <p>Automatické řízení je vypnuto. Systém neřídí topení automaticky. Toto může způsobit přehřátí nebo podchlazení nádrží!</p>
        <p><a href="{{ url_for('settings') }}" class="btn btn-warning">Přejít do nastavení</a></p>
    </div>

    <!-- Status Cards -->
    <div class="status-grid">
        <!-- Temperature Cards -->
        <div class="card">
            <h3>Nádrž 1</h3>
            <div class="temp-display" id="temp1">
                <span class="temp-value">--</span>
                <span class="temp-unit">°C</span>
            </div>
        </div>

        <div class="card">
            <h3>Nádrž 2</h3>
            <div class="temp-display" id="temp2">
                <span class="temp-value">--</span>
                <span class="temp-unit">°C</span>
            </div>
        </div>

        <div class="card">
            <h3>Nádrž 3</h3>
            <div class="temp-display" id="temp3">
                <span class="temp-value">--</span>
                <span class="temp-unit">°C</span>
            </div>
        </div>

        <div class="card card-highlight">
            <h3>Průměrná teplota</h3>
            <div class="temp-display" id="temp-avg">
                <span class="temp-value">--</span>
                <span class="temp-unit">°C</span>
            </div>
        </div>

        <!-- Control Status Cards -->
        <div class="card">
            <h3>Topení</h3>
            <div class="status-indicator">
                <span class="status-dot" id="heating-status"></span>
                <span class="status-text" id="heating-text">Vypnuto</span>
            </div>
        </div>

        <div class="card">
            <h3>Oběhové čerpadlo</h3>
            <div class="status-indicator">
                <span class="status-dot" id="pump-status"></span>
                <span class="status-text" id="pump-text">Vypnuto</span>
            </div>
        </div>

        <div class="card">
            <h3>Nastavená teplota</h3>
            <div class="temp-display">
                <span class="temp-value" id="setpoint">--</span>
                <span class="temp-unit">°C</span>
            </div>
        </div>

        <div class="card">
            <h3>Hystereze</h3>
            <div class="temp-display">
                <span class="temp-value" id="hysteresis">--</span>
                <span class="temp-unit">°C</span>
            </div>
        </div>
    </div>

    <!-- Temperature Chart -->
    <div class="card chart-card">
        <h3>Historie teplot</h3>
        <canvas id="temperatureChart"></canvas>
    </div>

    <!-- System Messages -->
    <div class="card">
        <h3>Systémové zprávy</h3>
        <div id="system-messages" class="message-list">
            <p class="message-empty">Žádné zprávy</p>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/vendor/socket.io.min.js') }}"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}
